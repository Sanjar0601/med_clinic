{% extends "base.html" %}
{% block content %}
<div class="max-w-5xl mx-auto p-6 bg-white shadow-md rounded-xl">
    <h2 class="text-2xl font-bold mb-6">Панель кассира</h2>

    {% if messages %}
        <ul class="mb-4 space-y-2">
            {% for message in messages %}
                <li class="p-2 rounded
                    {% if message.tags == 'success' %}bg-green-100 text-green-800
                    {% elif message.tags == 'warning' %}bg-yellow-100 text-yellow-800
                    {% else %}bg-red-100 text-red-800{% endif %}">
                    {{ message }}
                </li>
            {% endfor %}
        </ul>
    {% endif %}

    <table class="w-full border border-gray-200 rounded-lg overflow-hidden">
        <thead>
            <tr class="bg-gray-100 text-left">
                <th class="p-3 border">Счёт №</th>
                <th class="p-3 border">Пациент</th>
                <th class="p-3 border">Дата приёма</th>
                <th class="p-3 border">Сумма</th>
                <th class="p-3 border">Статус</th>
                <th class="p-3 border">Действие</th>
            </tr>
        </thead>
        <tbody>
            {% for invoice in invoices %}
            <tr class="hover:bg-gray-50">
                <td class="p-3 border">#{{ invoice.id }}</td>
                <td class="p-3 border">{{ invoice.appointment.patient.user.get_full_name }}</td>
                <td class="p-3 border">{{ invoice.appointment.appointment_date|date:"d.m.Y H:i" }}</td>
                <td class="p-3 border font-semibold">{{ invoice.total_amount }} сум</td>
                <td class="p-3 border">
                    {% if invoice.status == "оплачено" %}
                        <span class="text-green-600 font-semibold">Оплачено</span>
                    {% else %}
                        <span class="text-yellow-700 font-semibold">Ожидает оплаты</span>
                    {% endif %}
                </td>
                <td class="p-3 border">
                    {% if user.is_cashier and invoice.status != "оплачено" %}
                        <form method="post" action="{% url 'approve_payment' invoice.id %}">
                            {% csrf_token %}
                            <button type="submit"
                                class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                                Подтвердить оплату
                            </button>
                        </form>
                    {% else %}
                        —
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="p-4 text-center text-gray-500">Счетов пока нет.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
